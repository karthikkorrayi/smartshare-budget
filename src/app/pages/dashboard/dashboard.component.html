<div class="dashboard">

  <!-- LEFT COLUMN -->
  <div class="left-column">

    <!-- Greeting Card -->
    <mat-card class="card greeting-card greeting-modern">

    <!-- Header -->
    <div class="greeting-header">
      <div>
        <h4 class="greet-text">Hello üëã</h4>
        <h1 class="username">{{ username }}</h1>
        <p class="date-text">
          {{ today | date: 'dd MMMM, EEEE' }}
        </p>
      </div>

      <div class="month-select">
        <label>Month</label>
        <select [(ngModel)]="selectedMonth" (change)="onMonthChange()">
          <option *ngFor="let m of months" [value]="m.value">
            {{ m.label }}
          </option>
        </select>
      </div>
    </div>

    <!-- Progress -->
    <div class="progress-section">
      <div class="progress-info">
        <span class="progress-label">
          {{ completionPercent }}% completed
        </span>
        <span class="remaining" *ngIf="completionPercent < 100">
          {{ remainingDays }} days left
        </span>
      </div>

      <mat-progress-bar
        mode="determinate"
        [value]="completionPercent">
      </mat-progress-bar>
    </div>

  </mat-card>

    <!-- Category Gauge -->
    <mat-card class="card receivable-card">

      <!-- Header -->
      <div class="receivable-header">
        <h3>Amount to Receive</h3>
        <h1 class="total">‚Çπ{{ totalReceivable }}</h1>
      </div>

      <div class="divider"></div>

      <!-- Data Entry -->
      <div class="receivable-form">
        <div class="form-group">
          <label>Title</label>
          <input
            type="text"
            placeholder="Friend / Reason"
            [(ngModel)]="newReceivable.title"
          />
        </div>

        <div class="form-group amount-group">
          <label>Amount</label>
          <input
            type="number"
            placeholder="0"
            [(ngModel)]="newReceivable.amount"
          />
          <button class="add-btn" (click)="addReceivable()">+</button>
        </div>
      </div>

      <div class="divider"></div>

      <!-- List -->
      <div *ngFor="let r of receivables" class="receivable-row">
        <input
          type="checkbox"
          (change)="markReceivableReceived(r)"
        />

        <div class="row-content">
          <span class="title">{{ r.title }}</span>
          <span class="row-amount">‚Çπ{{ r.amount }}</span>
        </div>

        <span class="delete" (click)="deleteReceivable(r.id)">üóëÔ∏è</span>
      </div>

    </mat-card>

    <!-- Category Summary -->
   <mat-card class="card category-summary">
      <h3>Category Summary</h3>

      <div
        *ngFor="let cat of categorySummary"
        class="category-row-advanced"
      >
        <!-- Top Row -->
        <div class="category-top">
          <div class="category-left">
            <span class="category-icon">{{ cat.icon }}</span>
            <span class="category-name">{{ cat.name }}</span>
          </div>

          <div class="category-right">
            <span class="category-amount">‚Çπ{{ cat.amount }}</span>
          </div>
        </div>

        <!-- Progress -->
        <div class="category-progress">
          <mat-progress-bar
            mode="determinate"
            [value]="cat.percentage"
          ></mat-progress-bar>

          <span class="category-percent">
            {{ cat.percentage }}%
          </span>
        </div>
      </div>
    </mat-card>

  </div>

  <!-- CENTER COLUMN -->
  <div class="center-column">
    <!-- Recent Income Card -->
    <mat-card class="card recent-income-card">
      <div class="card-header">
        <h3>Recent Income</h3>
        <span class="income-icon">üí∞</span>
      </div>

      <!-- Empty State -->
      <div *ngIf="recentIncome.length === 0" class="empty-state">
        <div class="empty-icon">üìà</div>
        <p>No income recorded yet</p>
        <span>Add your first income entry</span>
      </div>

      <!-- Income List -->
      <div *ngFor="let inc of recentIncome" class="income-item">
        <div class="income-main">
          <div class="income-details">
            <span class="income-source">{{ inc.source }}</span>
            <span class="income-date">{{ inc.date.toDate() | date:'dd MMM, yyyy' }}</span>
          </div>
          <div class="income-amount">‚Çπ{{ inc.amount | number:'1.0-0' }}</div>
        </div>
        
        <div class="income-actions">
          <button class="action-btn edit" (click)="editIncome(inc)" title="Edit">
            <span>‚úèÔ∏è</span>
          </button>
          <button class="action-btn delete" (click)="deleteIncome(inc.id)" title="Delete">
            <span>üóëÔ∏è</span>
          </button>
        </div>
      </div>
    </mat-card>

    <!-- Top Stats -->
    <div class="stats-row">
      <div class="kpi-card income" [class.active]="availableBalance > 0">
        <p class="kpi-label">Total Income</p>
        <h2 class="kpi-value">‚Çπ{{ totalIncome | number:'1.0-0' }}</h2>
      </div>

      <div class="kpi-card expense">
        <p class="kpi-label">Total Spending</p>
        <h2 class="kpi-value">‚Çπ{{ totalExpenses | number:'1.0-0' }}</h2>
      </div>

      <div class="kpi-card balance" [class.active]="availableBalance > totalIncome * 0.5">
        <p class="kpi-label">Available Balance</p>
        <h2 class="kpi-value" [class.positive]="availableBalance > 0" [class.negative]="availableBalance < 0">
          ‚Çπ{{ availableBalance | number:'1.0-0' }}
        </h2>
      </div>
    </div>


    <!-- Monthly Bar Chart -->
    <!-- Monthly Bar Chart -->
    <mat-card class="card bar-chart">
      <div class="bar-chart-header">
        <h3>{{ selectedMonthLabel }}</h3>
        <span class="subtitle">Daily spending trend</span>
      </div>

      <div class="bar-chart-wrapper">
        <canvas id="monthlyBarChart"></canvas>
      </div>
    </mat-card>

    <!-- Spending Table -->
    <mat-card class="card spending-table">
      <h3>Spending Summary</h3>
      <table class="spending-table-ui">
        <tr>
          <th>Description</th>
          <th>Category</th>
          <th>Date</th>
          <th>Amount</th>
        </tr>

        <tr *ngFor="let exp of recentExpenses">
          <td>{{ exp.description }}</td>
          <td>{{ exp.category }}</td>
          <td>{{ exp.date.toDate() | date:'dd MMM' }}</td>
          <td>‚Çπ{{ exp.amount }}</td>
          <td>
            <span class="action" (click)="editExpense(exp)">‚úèÔ∏è</span>
            <span class="action" (click)="deleteExpense(exp.id)">üóëÔ∏è</span>
          </td>
        </tr>
      </table>
    </mat-card>

  </div>

  <!-- RIGHT COLUMN -->
  <div class="right-column">

    <!-- Spending Fulfillment -->
    <mat-card class="card fulfillment modern-line-card">
      <div class="line-header">
        <div>
          <h3>Monthly Spending Trend</h3>
          <p class="subtitle">
            {{ selectedMonth | date:'MMMM yyyy' }} vs previous month
          </p>
        </div>
      </div>

      <div class="line-chart-wrapper">
        <canvas id="spendingLineChart"></canvas>
      </div>

      <div class="line-info modern">
        <div>
          <span class="dot this"></span>
          <span>This Month</span>
          <strong>‚Çπ{{ totalExpenses }}</strong>
        </div>
        <div>
          <span class="dot last"></span>
          <span>Last Month</span>
          <strong>‚Çπ{{ lastMonthCumulative.at(-1) || 0 }}</strong>
        </div>
      </div>
    </mat-card>

    <!-- Upcoming Payments -->
    <mat-card class="card upcoming">
      <div class="upcoming-header">
        <h3>Upcoming Payments</h3>
        <span class="calendar-icon">üìÖ</span>
      </div>

      <!-- EMPTY STATE -->
      <div *ngIf="upcomingPayments.length === 0" class="upcoming-empty">
        <div class="empty-illustration">üì≠</div>
        <p>No upcoming payments</p>
        <span>You're all clear for now</span>
      </div>

      <!-- LIST -->
      <div *ngFor="let pay of upcomingPayments" class="upcoming-item">
        <div class="left">
          <input
            type="checkbox"
            (change)="markAsPaid(pay)"
          />

          <div class="details">
            <strong>{{ pay.description }}</strong>

            <span
              class="due-badge"
              [class.urgent]="pay.dueIn <= 3"
            >
              Due in {{ pay.dueIn }} day{{ pay.dueIn > 1 ? 's' : '' }}
            </span>
          </div>
        </div>

        <div class="right">
          <span class="amount">‚Çπ{{ pay.amount }}</span>
          <span
            class="delete"
            title="Remove"
            (click)="deleteUpcoming(pay.id)"
          >
            ‚úï
          </span>
        </div>
      </div>
    </mat-card>

</div>

<div class="fab-container">
  <button class="fab" (click)="toggleFab()">+</button>

  <div class="fab-menu" *ngIf="fabOpen">
    <button (click)="openAddExpense()">Add Expense</button>
    <button (click)="openAddIncome()">Add Income</button>
  </div>
</div>

